import argparse
import warnings
import os
from newsklearnBench import *

warnings.simplefilter("ignore")


def benchmark(inp,dataset_file: str, output_file: str,
              time: int, model: str, dataset_test_file: str = None,
              config: List[str] = None):
    model_to_bench = {
        'autosklearn': AutoSklearnBenchmark,
        'autosklearn-v': AutoSklearnVanillaBenchmark,
        'autosklearn-m': AutoSklearnMetaBenchmark,
        'autosklearn-e': AutoSklearnEnsBenchmark

    }
    if model in model_to_bench:
        model_to_bench[model]().benchmark(dataset_file=dataset_file, output_file=output_file,inp=inp,
                                          time_limit=time, dataset_test_file=dataset_test_file,
                                          config=config,model_name=model)

'''
if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('input_file', help='Dataset file')
    parser.add_argument('output_file', help='Benchmark result file')
    parser.add_argument('-t', '--time', type=int, help='Time budget')
    parser.add_argument('-m', '--model', help='AutoML Model')
    parser.add_argument('-te', '--test_file', help='Dataset test file')
    parser.add_argument('-c', '--config', nargs='*')
    args = parser.parse_args()
'''
with open('/home/dallal/benchmark/Datasets/newtest.txt', 'r') as fin:
    data = fin.read().splitlines()

if len(data) <= 0:
    exit()

#dataset = data[0]
d=data[0].split("&")

dataset=d[0]
model=d[1]
time_limit =int(d[2]) #60
inp=d[3].split("#")
print(d,dataset,time_limit,inp)
'''
model= 'autosklearn-v'
if model =='autosklearn-v':
    mo = 'v'
elif model =='autosklearn-m':
    mo = 'm'
elif model =='autosklearn-e':
    mo = 'e'
elif model =='autosklearn':
    mo = 'sk'
'''
log_file =""#"/home/dallal/benchmark/skout/"+str(d[0]+d[1])+"-"+mo+"-"+str(time_limit)+ ".txt"

dataset_file="/home/dallal/benchmark/Datasets/Datasets_Full/"+dataset+".csv"
benchmark(dataset_file=dataset_file, output_file=log_file,
              time=time_limit, model=model, dataset_test_file=None,
              config= None,inp=inp)

with open('/home/dallal/benchmark/Datasets/newtest.txt', 'w') as fout:
    for each in data[1:]:
        fout.write(each+"\n")

os.system('sudo reboot')
